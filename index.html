<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>DarkSky.net JavaScript Wrapper</title>
	<meta name="description" content="">
	<meta name="keywords" content="" />
	<meta name="author" content="">
  <style>
    body {
      margin: 0 auto;
      max-width: 600px;
      font-family: sans-serif;
    }
  </style>
</head>

<body>
	<h1>Forecast.io JS API</h1>
  <p>The examples below are the product of a request
    that takes two locations (Berlin and Abalessa) that are
    given in Lat Long coordinates.
  </p>
  <p>Temperature is expressed in Fahrenheit</p>
	<h2>Current Temperatures</h2>
	<div id="currentTemp">
    <p>Loading...</p>
  </div>

	<article class="article-daily">
  	<h2>Forecast for today</h2>
  </article>

  <article class="article-weekly">
  	<h2>Forecast for the week</h2>
  </article>

	<script src="require.js"></script>
<!--	<script src="forecast.io.js"</script> -->
	<script>
  var dailyArticle = document.querySelector('.article-daily');
  var weeklyArticle = document.querySelector('.article-weekly');
	var DarkSky = require(['darksky.net'], function(DarkSky) {
	    //This function is called when scripts/helper/util.js is loaded.
	    //If util.js calls define(), then this function is not fired until
	    //util's dependencies have loaded, and the util argument will hold
	    //the module value for 'helper/util'.

	    /*
		 * EXAMPLE LOCATION DATA
		 */
		var locations = [
			{
        name: 'Berlin',
				latitude: '52.4308',
				longitude: '13.2588'
			},
			{
        name: 'Abalessa',
        latitude: '22.4308',
				longitude: '3.2588'
			}
		];
		// Single Object Example
		// var locations = {
		// 	latitude: '52.4308',
		// 	longitude: '13.2588'
		// };

		var forecast = new DarkSky({
			PROXY_SCRIPT: 'proxy.php'
		});

		/*
		 * GET CURRENT CONDITIONS
		 */
		forecast.getCurrentConditions(locations, function(locsCurrCond) {
      var items = '';
      for (var i = 0; i < locsCurrCond.length; i++) {
        var locCurrCond = locsCurrCond[i];
        items += '<p>' + locsCurrCond[i].name + '</p>';
        //Call desired fns
        items += '<p>Temperature: ' + locCurrCond.temperature() + '</p>';
      }
			document.getElementById('currentTemp').innerHTML = items;
		});

		/*
		 * GET HOURLY CONDITIONS FOR TODAY
		 */
		forecast.getForecastToday(locations, function(locsDailyCond) {
      //HTML
			var items = '';
      locsDailyCond.forEach(function(item, index) {
        var section = document.createElement('section');
        dailyArticle.appendChild(section);
      });
      var sections = document.querySelectorAll('.article-daily section');
      //Output
      for (var i = 0; i < locsDailyCond.length; i++) {
        //Data output
        var locDailyCond = locsDailyCond[i];
        items += '<p>' + locDailyCond[i].name + '</p>';
        for (var j = 0; j < locDailyCond.length; j++) {
          items += '<p>Time: ' + locDailyCond[j].time('HH:mm') + ': temperature ' + locDailyCond[j].temperature() + '</p>';
        }
        var tempDiv = document.createElement('div');
        tempDiv.innerHTML = items;
        sections[i].appendChild(tempDiv);
			}
		});

		/*
		 * GET DAILY CONDITIONS FOR NEXT 7 DAYS
		 */
		forecast.getForecastWeek(locations, function(locsWeeklyCond) {
      //html
			var items = '';
      locsWeeklyCond.forEach(function() {
        var section = document.createElement('section');
        weeklyArticle.appendChild(section);
      });
      var sections = document.querySelectorAll('.article-weekly section');
      console.log('sections', sections);
      //Output
      for (var i = 0; i < locsWeeklyCond.length; i++) {
        //Data output
        var locWeeklyCond = locsWeeklyCond[i];
        items += '<p>' + locWeeklyCond[i].name + '</p>';
        for (var j = 0; j < locWeeklyCond.length; j++) {
          items += '<p>Date: ' + locWeeklyCond[j].time('YYYY-MM-DD') + ': Max temperature ' + locWeeklyCond[j].temperatureMax() + '</p>';
        }
        var tempDiv = document.createElement('div');
        tempDiv.innerHTML = items;
        sections[i].appendChild(tempDiv);
      }
		});
	});

	</script>
</body>
</html>
